
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
        <meta name="description" content="Learn to configure the Splunk OpenTelemetry Connector for APM and Infrastructure Monitoring as well as instrument applications with OpenTelemetry APM instrumentation to send telemetry to Splunk APM">
      
      
      
        <meta name="author" content="Steve Lerner Staff Sales Engineer USA">
      
      
        <link rel="canonical" href="https://github.com/otelworkshop/apm/k8s/">
      
      <link rel="icon" href="../../images/favicon.ico">
      <meta name="generator" content="mkdocs-1.2.2, mkdocs-material-7.3.3">
    
    
      
        <title>APM for k8s - Splunk OpenTelemetry Workshop</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/main.5143246d.min.css">
      
        
        <link rel="stylesheet" href="../../assets/stylesheets/palette.3f5d1f46.min.css">
        
      
    
    
    
      
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Century+Gothic:300,400,400i,700%7CRoboto+Mono&display=fallback">
        <style>:root{--md-text-font-family:"Century Gothic";--md-code-font-family:"Roboto Mono"}</style>
      
    
    
    
      <link rel="stylesheet" href="../../stylesheets/extra.css">
    
    
      


    
    
    
    
      
    
    <meta property="og:type" content="website">
    <meta property="og:title" content="Splunk OpenTelemetry Workshop - APM for k8s">
    <meta property="og:description" content="Learn to configure the Splunk OpenTelemetry Connector for APM and Infrastructure Monitoring as well as instrument applications with OpenTelemetry APM instrumentation to send telemetry to Splunk APM">
    <meta property="og:url" content="https://github.com/otelworkshop/apm/k8s/">
    <meta property="og:image" content="">
    <meta property="og:image:type" content="image/png">
    <meta property="og:image:width" content="1080">
    <meta property="og:image:height" content="568">
  
  </head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="" data-md-color-accent="">
  
    
    <script>function __prefix(e){return new URL("../..",location).pathname+"."+e}function __get(e,t=localStorage){return JSON.parse(t.getItem(__prefix(e)))}</script>
    
      <script>var palette=__get("__palette");if(null!==palette&&"object"==typeof palette.color)for(var key in palette.color)document.body.setAttribute("data-md-color-"+key,palette.color[key])</script>
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#1-use-data-setup-wizard-for-splunk-otel-collector-pod-on-k3s" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
        <aside class="md-banner md-announce">
          <div class="md-banner__inner md-announce__inner md-grid md-typeset">
            
    <a href="https://twitter.com/splunk" style="color: #fff;">
      For Observability updates follow <strong>@splunk</strong> on
      <span class="twemoji twitter">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path d="M459.37 151.716c.325 4.548.325 9.097.325 13.645 0 138.72-105.583 298.558-298.558 298.558-59.452 0-114.68-17.219-161.137-47.106 8.447.974 16.568 1.299 25.34 1.299 49.055 0 94.213-16.568 130.274-44.832-46.132-.975-84.792-31.188-98.112-72.772 6.498.974 12.995 1.624 19.818 1.624 9.421 0 18.843-1.3 27.614-3.573-48.081-9.747-84.143-51.98-84.143-102.985v-1.299c13.969 7.797 30.214 12.67 47.431 13.319-28.264-18.843-46.781-51.005-46.781-87.391 0-19.492 5.197-37.36 14.294-52.954 51.655 63.675 129.3 105.258 216.365 109.807-1.624-7.797-2.599-15.918-2.599-24.04 0-57.828 46.782-104.934 104.934-104.934 30.213 0 57.502 12.67 76.67 33.137 23.715-4.548 46.456-13.32 66.599-25.34-7.798 24.366-24.366 44.833-46.132 57.827 21.117-2.273 41.584-8.122 60.426-16.243-14.292 20.791-32.161 39.308-52.628 54.253z"/></svg>
      </span>
      <strong>Twitter</strong>
    </a>
  
          </div>
        </aside>
      
    </div>
    
      

<header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../.." title="Splunk OpenTelemetry Workshop" class="md-header__button md-logo" aria-label="Splunk OpenTelemetry Workshop" data-md-component="logo">
      
  <img src="../../images/logo.png" alt="logo">

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Splunk OpenTelemetry Workshop
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              APM for k8s
            
          </span>
        </div>
      </div>
    </div>
    
      <form class="md-header__option" data-md-component="palette">
        
          
          
          <input class="md-option" data-md-color-media="(prefers-color-scheme: light)" data-md-color-scheme="default" data-md-color-primary="" data-md-color-accent=""  aria-label="Switch to dark mode"  type="radio" name="__palette" id="__palette_1">
          
            <label class="md-header__button md-icon" title="Switch to dark mode" for="__palette_2" hidden>
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M17 6H7c-3.31 0-6 2.69-6 6s2.69 6 6 6h10c3.31 0 6-2.69 6-6s-2.69-6-6-6zm0 10H7c-2.21 0-4-1.79-4-4s1.79-4 4-4h10c2.21 0 4 1.79 4 4s-1.79 4-4 4zM7 9c-1.66 0-3 1.34-3 3s1.34 3 3 3 3-1.34 3-3-1.34-3-3-3z"/></svg>
            </label>
          
        
          
          
          <input class="md-option" data-md-color-media="(prefers-color-scheme: dark)" data-md-color-scheme="slate" data-md-color-primary="" data-md-color-accent=""  aria-label="Switch to light mode"  type="radio" name="__palette" id="__palette_2">
          
            <label class="md-header__button md-icon" title="Switch to light mode" for="__palette_1" hidden>
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M17 7H7a5 5 0 0 0-5 5 5 5 0 0 0 5 5h10a5 5 0 0 0 5-5 5 5 0 0 0-5-5m0 8a3 3 0 0 1-3-3 3 3 0 0 1 3-3 3 3 0 0 1 3 3 3 3 0 0 1-3 3z"/></svg>
            </label>
          
        
      </form>
    
    
    
    
      <div class="md-header__source">
        
<a href="https://github.com/signalfx/otelworkshop/" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    GitHub
  </div>
</a>
      </div>
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
            
<nav class="md-tabs" aria-label="Tabs" data-md-component="tabs">
  <div class="md-tabs__inner md-grid">
    <ul class="md-tabs__list">
      
        
  
  


  <li class="md-tabs__item">
    <a href="../.." class="md-tabs__link">
      Home
    </a>
  </li>

      
        
  
  
    
  


  
  
  
    <li class="md-tabs__item">
      <a href="../../introduction/" class="md-tabs__link md-tabs__link--active">
        OpenTelemetry Workshop
      </a>
    </li>
  

      
    </ul>
  </div>
</nav>
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

  


<nav class="md-nav md-nav--primary md-nav--lifted" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../.." title="Splunk OpenTelemetry Workshop" class="md-nav__button md-logo" aria-label="Splunk OpenTelemetry Workshop" data-md-component="logo">
      
  <img src="../../images/logo.png" alt="logo">

    </a>
    Splunk OpenTelemetry Workshop
  </label>
  
    <div class="md-nav__source">
      
<a href="https://github.com/signalfx/otelworkshop/" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    GitHub
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../.." class="md-nav__link">
        Home
      </a>
    </li>
  

    
      
      
      

  
  
    
  
  
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_2" type="checkbox" id="__nav_2" checked>
      
      
      
      
        <label class="md-nav__link" for="__nav_2">
          OpenTelemetry Workshop
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="OpenTelemetry Workshop" data-md-level="1">
        <label class="md-nav__title" for="__nav_2">
          <span class="md-nav__icon md-icon"></span>
          OpenTelemetry Workshop
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../introduction/" class="md-nav__link">
        Introduction
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../workshop-steps/prep/" class="md-nav__link">
        Preparation
      </a>
    </li>
  

            
          
            
              
  
  
    
  
  
    
      
    
    <li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_2_3" type="checkbox" id="__nav_2_3" checked>
      
      
      
      
        <label class="md-nav__link" for="__nav_2_3">
          Workshop Labs
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Workshop Labs" data-md-level="2">
        <label class="md-nav__title" for="__nav_2_3">
          <span class="md-nav__icon md-icon"></span>
          Workshop Labs
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_2_3_1" data-md-state="indeterminate" type="checkbox" id="__nav_2_3_1" checked>
      
      
      
      
        <label class="md-nav__link" for="__nav_2_3_1">
          APM for a Single Host (Execute in Order)
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="APM for a Single Host (Execute in Order)" data-md-level="3">
        <label class="md-nav__title" for="__nav_2_3_1">
          <span class="md-nav__icon md-icon"></span>
          APM for a Single Host (Execute in Order)
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../host/" class="md-nav__link">
        Install Otel Collector
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../host/python/" class="md-nav__link">
        Python- Deploy Server and Client
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../host/java/" class="md-nav__link">
        Java
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../host/node/" class="md-nav__link">
        Node.js
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
    
  
  
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_2_3_2" type="checkbox" id="__nav_2_3_2" checked>
      
      
      
      
        <label class="md-nav__link" for="__nav_2_3_2">
          APM for K8s / containerized apps
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="APM for K8s / containerized apps" data-md-level="3">
        <label class="md-nav__title" for="__nav_2_3_2">
          <span class="md-nav__icon md-icon"></span>
          APM for K8s / containerized apps
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
    
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" data-md-toggle="toc" type="checkbox" id="__toc">
      
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          APM for k8s
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        APM for k8s
      </a>
      
        
<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#1-use-data-setup-wizard-for-splunk-otel-collector-pod-on-k3s" class="md-nav__link">
    1: Use Data Setup Wizard for Splunk Otel Collector Pod on k3s
  </a>
  
    <nav class="md-nav" aria-label="1: Use Data Setup Wizard for Splunk Otel Collector Pod on k3s">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#1a-splunk-observability-cloud-portal" class="md-nav__link">
    1a: Splunk Observability Cloud Portal
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#1b-update-k3s-for-splunk-log-observer-ignore-if-you-are-using-k8s" class="md-nav__link">
    1b: Update k3s For Splunk Log Observer (Ignore if you are using k8s)
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#prepare-values-for-collector-update" class="md-nav__link">
    Prepare values for Collector update
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#prepare-valuesyaml-file-for-updating-the-helm-chart" class="md-nav__link">
    Prepare values.yaml file for updating the Helm chart
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#update-the-collector" class="md-nav__link">
    Update the Collector
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#2-deploy-apm-for-containerized-apps-python-and-java" class="md-nav__link">
    2: Deploy APM For Containerized Apps: Python and Java
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#3-monitor-jvm-metrics-for-a-java-container" class="md-nav__link">
    3: Monitor JVM Metrics For a Java Container
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#4-manually-instrument-a-java-app-and-add-custom-tags" class="md-nav__link">
    4:  Manually instrument a Java App And Add Custom Tags
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#5-process-spans-with-the-otel-collector" class="md-nav__link">
    5: Process Spans with the Otel Collector
  </a>
  
    <nav class="md-nav" aria-label="5: Process Spans with the Otel Collector">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#prepare-values-for-collector-update_1" class="md-nav__link">
    Prepare values for Collector update
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#span-processing-example-redacting-data-from-a-span-attribute" class="md-nav__link">
    Span Processing Example: Redacting Data from a Span Attribute
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#prepare-valuesyaml-file-for-updating-the-helm-chart_1" class="md-nav__link">
    Prepare values.yaml file for updating the Helm chart
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#update-the-collector_1" class="md-nav__link">
    Update the Collector
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#6-receive-prometheus-metrics-at-the-otel-collector" class="md-nav__link">
    6: Receive Prometheus Metrics at the Otel Collector
  </a>
  
    <nav class="md-nav" aria-label="6: Receive Prometheus Metrics at the Otel Collector">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#add-a-prometheus-endpoint-pod" class="md-nav__link">
    Add a Prometheus endpoint pod
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#update-otel-collector-to-scrape-the-prometheus-pod" class="md-nav__link">
    Update Otel Collector to Scrape the Prometheus Pod
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#find-prometheus-metric-and-generate-chart" class="md-nav__link">
    Find Prometheus Metric and Generate Chart
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#7-configure-otel-collector-to-transform-a-metric-name" class="md-nav__link">
    7: Configure Otel Collector to Transform a Metric Name
  </a>
  
    <nav class="md-nav" aria-label="7: Configure Otel Collector to Transform a Metric Name">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#find-transformed-prometheus-metric-and-generate-chart" class="md-nav__link">
    Find Transformed Prometheus Metric and Generate Chart
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#monitoring-and-troubleshooting" class="md-nav__link">
    Monitoring and Troubleshooting
  </a>
  
    <nav class="md-nav" aria-label="Monitoring and Troubleshooting">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#view-otel-collector-pod-stats" class="md-nav__link">
    View Otel Collector POD stats
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#examine-otel-collector-config" class="md-nav__link">
    Examine Otel Collector Config
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#bonus-instrumentation-examples-istio-and-net" class="md-nav__link">
    Bonus Instrumentation Examples: Istio and .NET
  </a>
  
    <nav class="md-nav" aria-label="Bonus Instrumentation Examples: Istio and .NET">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#net-containerized-example-is-located-here" class="md-nav__link">
    .NET: containerized example is located here
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#istio-service-mesh-lab-here" class="md-nav__link">
    Istio: service mesh lab here
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#clean-up-deployments-and-services" class="md-nav__link">
    Clean up deployments and services
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    
<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#1-use-data-setup-wizard-for-splunk-otel-collector-pod-on-k3s" class="md-nav__link">
    1: Use Data Setup Wizard for Splunk Otel Collector Pod on k3s
  </a>
  
    <nav class="md-nav" aria-label="1: Use Data Setup Wizard for Splunk Otel Collector Pod on k3s">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#1a-splunk-observability-cloud-portal" class="md-nav__link">
    1a: Splunk Observability Cloud Portal
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#1b-update-k3s-for-splunk-log-observer-ignore-if-you-are-using-k8s" class="md-nav__link">
    1b: Update k3s For Splunk Log Observer (Ignore if you are using k8s)
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#prepare-values-for-collector-update" class="md-nav__link">
    Prepare values for Collector update
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#prepare-valuesyaml-file-for-updating-the-helm-chart" class="md-nav__link">
    Prepare values.yaml file for updating the Helm chart
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#update-the-collector" class="md-nav__link">
    Update the Collector
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#2-deploy-apm-for-containerized-apps-python-and-java" class="md-nav__link">
    2: Deploy APM For Containerized Apps: Python and Java
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#3-monitor-jvm-metrics-for-a-java-container" class="md-nav__link">
    3: Monitor JVM Metrics For a Java Container
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#4-manually-instrument-a-java-app-and-add-custom-tags" class="md-nav__link">
    4:  Manually instrument a Java App And Add Custom Tags
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#5-process-spans-with-the-otel-collector" class="md-nav__link">
    5: Process Spans with the Otel Collector
  </a>
  
    <nav class="md-nav" aria-label="5: Process Spans with the Otel Collector">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#prepare-values-for-collector-update_1" class="md-nav__link">
    Prepare values for Collector update
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#span-processing-example-redacting-data-from-a-span-attribute" class="md-nav__link">
    Span Processing Example: Redacting Data from a Span Attribute
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#prepare-valuesyaml-file-for-updating-the-helm-chart_1" class="md-nav__link">
    Prepare values.yaml file for updating the Helm chart
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#update-the-collector_1" class="md-nav__link">
    Update the Collector
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#6-receive-prometheus-metrics-at-the-otel-collector" class="md-nav__link">
    6: Receive Prometheus Metrics at the Otel Collector
  </a>
  
    <nav class="md-nav" aria-label="6: Receive Prometheus Metrics at the Otel Collector">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#add-a-prometheus-endpoint-pod" class="md-nav__link">
    Add a Prometheus endpoint pod
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#update-otel-collector-to-scrape-the-prometheus-pod" class="md-nav__link">
    Update Otel Collector to Scrape the Prometheus Pod
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#find-prometheus-metric-and-generate-chart" class="md-nav__link">
    Find Prometheus Metric and Generate Chart
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#7-configure-otel-collector-to-transform-a-metric-name" class="md-nav__link">
    7: Configure Otel Collector to Transform a Metric Name
  </a>
  
    <nav class="md-nav" aria-label="7: Configure Otel Collector to Transform a Metric Name">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#find-transformed-prometheus-metric-and-generate-chart" class="md-nav__link">
    Find Transformed Prometheus Metric and Generate Chart
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#monitoring-and-troubleshooting" class="md-nav__link">
    Monitoring and Troubleshooting
  </a>
  
    <nav class="md-nav" aria-label="Monitoring and Troubleshooting">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#view-otel-collector-pod-stats" class="md-nav__link">
    View Otel Collector POD stats
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#examine-otel-collector-config" class="md-nav__link">
    Examine Otel Collector Config
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#bonus-instrumentation-examples-istio-and-net" class="md-nav__link">
    Bonus Instrumentation Examples: Istio and .NET
  </a>
  
    <nav class="md-nav" aria-label="Bonus Instrumentation Examples: Istio and .NET">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#net-containerized-example-is-located-here" class="md-nav__link">
    .NET: containerized example is located here
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#istio-service-mesh-lab-here" class="md-nav__link">
    Istio: service mesh lab here
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#clean-up-deployments-and-services" class="md-nav__link">
    Clean up deployments and services
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content" data-md-component="content">
            <article class="md-content__inner md-typeset">
              
                
                
                  <h1>APM for k8s</h1>
                
                <p>Identify your token and realm from the Splunk Observability Cloud Portal: <br />
<code>Organization Settings-&gt;Access Tokens</code> and <code>Your Name-&gt;Account Settings</code>  </p>
<blockquote>
<p><ins>If using your own k8s cluster on an Ubuntu host</ins><br />
Remove the Otel Collector if its running on the same host as your k8s cluster:
<div class="highlight"><pre><span></span><code>sudo sh /tmp/splunk-otel-collector.sh --uninstall
</code></pre></div>
Use this setup script to bootstrap your Debian based k8s environment with everything needed for the k8s workshop:<br />
<div class="highlight"><pre><span></span><code>bash &lt;(curl -s https://raw.githubusercontent.com/signalfx/otelworkshop/master/setup-tools/k8s-env-only.sh)
</code></pre></div>
Ensure you have <code>helm</code> and <code>lynx</code> installed.  </p>
<p>Skip to: <strong>2: Deploy APM for containerized apps: Python and Java</strong><br />
If you are using k8s anywhere else you can still do this workshop but will need to ensure <code>helm</code>, <code>lynx</code> are available.</p>
</blockquote>
<hr />
<h3 id="1-use-data-setup-wizard-for-splunk-otel-collector-pod-on-k3s">1: Use Data Setup Wizard for Splunk Otel Collector Pod on k3s<a class="headerlink" href="#1-use-data-setup-wizard-for-splunk-otel-collector-pod-on-k3s" title="Permanent link">&para;</a></h3>
<blockquote>
<p><strong>IMPORTANT: If you have the Otel Collector and prior lab examples running on a host, them at this time:</strong><br />
Stop all the prior labs apps by using <code>ctrl-c</code> in each terminal window and then closing the window.<br />
Remove the host based otel collector: 
<code>sudo sh /tmp/splunk-otel-collector.sh --uninstall</code></p>
</blockquote>
<h4 id="1a-splunk-observability-cloud-portal">1a: Splunk Observability Cloud Portal<a class="headerlink" href="#1a-splunk-observability-cloud-portal" title="Permanent link">&para;</a></h4>
<p>In Splunk Observability Cloud: <code>Data Setup-&gt;Kubernetes-&gt;Add Connection</code>  </p>
<p><img src="../../images/17-datasetup-k8s.png" width="360">  </p>
<p>Choose the following:</p>
<table>
<thead>
<tr>
<th>Key</th>
<th>Value</th>
</tr>
</thead>
<tbody>
<tr>
<td>Access Token</td>
<td>Select from list</td>
</tr>
<tr>
<td>Cluster Name</td>
<td>Your initials-cluster i.e. SL-cluster</td>
</tr>
<tr>
<td>Provider</td>
<td>Other</td>
</tr>
<tr>
<td>Distribution</td>
<td>Other</td>
</tr>
<tr>
<td>Add Gateway</td>
<td>No</td>
</tr>
<tr>
<td>Log Collection</td>
<td>True</td>
</tr>
</tbody>
</table>
<p>And then select <code>Next</code>  </p>
<p>Follow the steps on the <code>Install Integration</code> page.</p>
<p><img src="../../images/18-datasetup-k8sinstall.png" width="360"> </p>
<p>A result will look like this:<br />
<div class="highlight"><pre><span></span><code>NAME: splunk-otel-collector-1620505665
LAST DEPLOYED: Sat May  8 20:27:46 2021
NAMESPACE: default
STATUS: deployed
REVISION: 1
TEST SUITE: None
</code></pre></div></p>
<p>Note the name of the deployment when the install completes i.e.:   <code>splunk-otel-collector-1620505665</code>  </p>
<h4 id="1b-update-k3s-for-splunk-log-observer-ignore-if-you-are-using-k8s">1b: Update k3s For Splunk Log Observer (Ignore if you are using k8s)<a class="headerlink" href="#1b-update-k3s-for-splunk-log-observer-ignore-if-you-are-using-k8s" title="Permanent link">&para;</a></h4>
<p>k3s has a different format that standard k8s for logging and we need to update our deployment for this.  </p>
<p>You'll need the Collector deployment from the Data Setup Wizard install.  </p>
<p>You can also dervice this from using <code>helm list</code> i.e.:<br />
<div class="highlight"><pre><span></span><code>NAME                                    NAMESPACE       REVISION        UPDATED                                 STATUS       CHART                           APP VERSION
splunk-otel-collector-1620504591        default         1               2021-05-08 20:09:51.625419479 +0000 UTC deployed     splunk-otel-collector-0.25.0  
</code></pre></div>
The deployment name would be: <code>splunk-otel-collector-1620504591</code>  </p>
<h4 id="prepare-values-for-collector-update">Prepare values for Collector update<a class="headerlink" href="#prepare-values-for-collector-update" title="Permanent link">&para;</a></h4>
<p>If you run into any errors from helm, fix with:<br />
<div class="highlight"><pre><span></span><code>export KUBECONFIG=/etc/rancher/k3s/k3s.yaml
sudo chmod 755 /etc/rancher/k3s/k3s.yaml
</code></pre></div></p>
<p>Prep values for collector update:  </p>
<p><code>helm list</code><br />
<code>helm get values NAME</code>  </p>
<p>i.e. <code>helm get values splunk-otel-collector-1620609739</code></p>
<p>make note of:<br />
<code>clusterNAME</code><br />
<code>splunkAccessToken</code><br />
<code>splunkRealm</code>  </p>
<h4 id="prepare-valuesyaml-file-for-updating-the-helm-chart">Prepare values.yaml file for updating the Helm chart<a class="headerlink" href="#prepare-valuesyaml-file-for-updating-the-helm-chart" title="Permanent link">&para;</a></h4>
<p>Start in k8s directory:
<div class="highlight"><pre><span></span><code><span class="nb">cd</span> ~/otelworkshop/k8s
</code></pre></div></p>
<p>Edit <code>k3slogs.yaml</code> with thes values above.</p>
<h4 id="update-the-collector">Update the Collector<a class="headerlink" href="#update-the-collector" title="Permanent link">&para;</a></h4>
<p>Install the Collector configuration chart:  </p>
<div class="highlight"><pre><span></span><code>helm upgrade \
YOURCOLLECTORHERE \
--values k3slogs.yaml \
splunk-otel-collector-chart/splunk-otel-collector
</code></pre></div>
<p>i.e.</p>
<div class="highlight"><pre><span></span><code>helm upgrade \
splunk-otel-collector-1620609739 \
--values k3slogs.yaml \
splunk-otel-collector-chart/splunk-otel-collector
</code></pre></div>
<hr />
<h3 id="2-deploy-apm-for-containerized-apps-python-and-java">2: Deploy APM For Containerized Apps: Python and Java<a class="headerlink" href="#2-deploy-apm-for-containerized-apps-python-and-java" title="Permanent link">&para;</a></h3>
<p>Deploy the Flask server deployment/service and the python-requests (makes requests of Flask server) pod:<br />
<div class="highlight"><pre><span></span><code>cd ~/otelworkshop/k8s
kubectl apply -f py-deployment.yaml
</code></pre></div></p>
<p>Deploy the Java OKHTTP requests pod (makes requests of Flask server):<br />
<div class="highlight"><pre><span></span><code>kubectl apply -f java-deployment.yaml
</code></pre></div>
Study the results:</p>
<p>The APM Dashboard will show the instrumented Python-Requests and Java OKHTTP clients posting to the Flask Server.<br />
Make sure you select the <code>apm-workshop</code> ENVIRONMENT to monitor.</p>
<p><img src="../../images/19-k8s-apm.png" width="360">  </p>
<p>Study the <code>deployment.yaml</code> files:</p>
<p>Example in Github or:<br />
<div class="highlight"><pre><span></span><code>~/otelworkshop/k8s/py-deployment.yaml   
~/otelworkshop/k8s/java-deployment.yaml   
</code></pre></div>
The .yaml files show the environment variables telling the instrumentation to send spans to the OpenTelemetry Collector.</p>
<p>Normally we use an environment variable pointing to <code>localhost</code> on a single host application where the SmartAgent is running. In k8s we have separate pods in a cluster for apps and the Collector.   </p>
<p>The Collector pod is running with <ins>node wide visibility</ins>, so to tell each application pod where to send spans:</p>
<div class="highlight"><pre><span></span><code>- name: SPLUNK_OTEL_AGENT
  valueFrom:
    fieldRef:
      fieldPath: status.hostIP
- name: OTEL_EXPORTER_JAEGER_ENDPOINT
  value: http://$(SPLUNK_OTEL_AGENT):9080/v1/trace
</code></pre></div>
<hr />
<h3 id="3-monitor-jvm-metrics-for-a-java-container">3: Monitor JVM Metrics For a Java Container<a class="headerlink" href="#3-monitor-jvm-metrics-for-a-java-container" title="Permanent link">&para;</a></h3>
<p>JVM Metrics are emitted by the Splunk OpenTelemetry Java instrumentation and send to the Collector.  </p>
<p>Download this file to your local machine: <a href="https://raw.githubusercontent.com/signalfx/otelworkshop/master/k8s/dashboard_JVMMetrics.json">JVM Metrics Dashboard Template</a>  </p>
<p>Select the + Icon on top right and create a new <strong>Dashboard Group</strong> called <code>test</code>  </p>
<p>Click the + Icon again and select <code>Import-&gt;Dahsboard</code><br />
and select the downloaded <code>dashboard_JVMMetrics.json</code> file.   </p>
<p><img src="../../images/27-jvm.png" width="360">    </p>
<p>Filter by Application by adding <code>service:SERVICENAMEHERE</code>  </p>
<p><img src="../../images/28-jvm-filter.png" width="360">    </p>
<p>Complete JVM metrics available <a href="https://github.com/signalfx/splunk-otel-java/blob/main/docs/metrics.md#jvm">at this link</a></p>
<hr />
<h3 id="4-manually-instrument-a-java-app-and-add-custom-tags">4:  Manually instrument a Java App And Add Custom Tags<a class="headerlink" href="#4-manually-instrument-a-java-app-and-add-custom-tags" title="Permanent link">&para;</a></h3>
<p>Let's say you have an app that has your own functions and doesn't only use auto-instrumented frameworks- or doesn't have any of them!  </p>
<p>You can easily manually instrument your functions and have them appear as part of a service, or as an entire service.</p>
<p>Example is here:</p>
<p><code>cd ~/otelworkshop/k8s/java/manual-inst</code>  </p>
<p>Deploy an app with ONLY manual instrumentation:
<div class="highlight"><pre><span></span><code>kubectl apply -f java-reqs-manual-inst.yaml
</code></pre></div></p>
<p>When this app deploys, it appears as an isolated bubble in the map. It has all metrics and tracing just like an auto-instrumented app does. </p>
<p><img src="../../images/20-k8s-manual.png" width="360">  </p>
<p>Take a look at the traces and their spans to see the manually added values of Message, Logs etc.</p>
<p><img src="../../images/21-k8s-m-trace.png" width="360">  </p>
<p>You will see the function called ExampleSpan with custom <code>Logging</code> messages and a <code>message:myevent</code> span/tag.  </p>
<p><img src="../../images/22-k8s-m-span1.png" width="360">  </p>
<p><img src="../../images/23-k8s-m-span2.png" width="360"> </p>
<p>Study the <a href="https://github.com/signalfx/otelworkshop/blob/master/k8s/java/manual-inst/src/main/java/sf/main/GetExample.java">manual instrumentation code example here.</a></p>
<p>There are two methods shown- the decorator @WithSpan method (easiest), and using the GlobalTracer method (more complicated/powerful)...</p>
<p>Note that this is the most minimal example of manual instrumentation- there is a vast amount of power available in OpenTelemetry- please see <a href="https://github.com/open-telemetry/opentelemetry-java-instrumentation">the documentation</a> and <a href="https://github.com/open-telemetry/opentelemetry-java/blob/master/QUICKSTART.md#tracing">in depth details</a></p>
<hr />
<h3 id="5-process-spans-with-the-otel-collector">5: Process Spans with the Otel Collector<a class="headerlink" href="#5-process-spans-with-the-otel-collector" title="Permanent link">&para;</a></h3>
<p>The Otel Collector has many powerful configuration options ranging from splitting telemetry to multiple destinations to sampling to span processing.  </p>
<p><a href="https://github.com/open-telemetry/opentelemetry-collector/tree/main/processor">Processor documentation</a>  </p>
<p><a href="https://github.com/signalfx/splunk-otel-collector-chart/tree/main/examples">Collector config examples</a>  </p>
<p><a href="https://github.com/signalfx/splunk-otel-collector">Full documentation</a>  </p>
<h4 id="prepare-values-for-collector-update_1">Prepare values for Collector update<a class="headerlink" href="#prepare-values-for-collector-update_1" title="Permanent link">&para;</a></h4>
<p><div class="highlight"><pre><span></span><code>helm list
</code></pre></div>
<div class="highlight"><pre><span></span><code>helm get values NAME
</code></pre></div></p>
<p>i.e. <code>helm get values splunk-otel-collector-1620609739</code></p>
<p>make note of:<br />
<code>clusterNAME</code><br />
<code>splunkAccessToken</code><br />
<code>splunkRealm</code>  </p>
<h4 id="span-processing-example-redacting-data-from-a-span-attribute">Span Processing Example: Redacting Data from a Span Attribute<a class="headerlink" href="#span-processing-example-redacting-data-from-a-span-attribute" title="Permanent link">&para;</a></h4>
<p>Change to the example directory:
<div class="highlight"><pre><span></span><code>cd ~/otelworkshop/k8s/collectorconfig
</code></pre></div></p>
<h4 id="prepare-valuesyaml-file-for-updating-the-helm-chart_1">Prepare values.yaml file for updating the Helm chart<a class="headerlink" href="#prepare-valuesyaml-file-for-updating-the-helm-chart_1" title="Permanent link">&para;</a></h4>
<p>Edit <code>spanprocessor.yaml</code> with thes values from Step 1.  </p>
<h4 id="update-the-collector_1">Update the Collector<a class="headerlink" href="#update-the-collector_1" title="Permanent link">&para;</a></h4>
<p>Install the Collector configuration chart:  </p>
<div class="highlight"><pre><span></span><code>helm upgrade --install \ 
YOURCOLLECTORHERE \
--values spanprocessor.yaml \
splunk-otel-collector-chart/splunk-otel-collector
</code></pre></div>
<p>i.e.</p>
<div class="highlight"><pre><span></span><code>helm upgrade  --install \
splunk-otel-collector-1620609739 \
--values spanprocessor.yaml \
splunk-otel-collector-chart/splunk-otel-collector
</code></pre></div>
<p>Study the results:  </p>
<p><code>Splunk Observability Portal -&gt; APM -&gt; Explore -&gt; java-otel-manual-inst -&gt; Traces</code></p>
<p>Example <code>my.key</code> and you'll see that the value is <code>redacted</code> after applying the <code>spanprocessor.yaml</code> example</p>
<p><img src="../../images/25-span-redacted.png" width="360">  </p>
<p>If you want to make changes and update the <code>spanprocessor.yaml</code> or add more configurations, use:<br />
<code>helm upgrade --reuse-values</code></p>
<hr />
<h3 id="6-receive-prometheus-metrics-at-the-otel-collector">6: Receive Prometheus Metrics at the Otel Collector<a class="headerlink" href="#6-receive-prometheus-metrics-at-the-otel-collector" title="Permanent link">&para;</a></h3>
<h4 id="add-a-prometheus-endpoint-pod">Add a Prometheus endpoint pod<a class="headerlink" href="#add-a-prometheus-endpoint-pod" title="Permanent link">&para;</a></h4>
<p>Change to the k8s Collector Config directory:<br />
<div class="highlight"><pre><span></span><code>cd ~/otelworkshop/k8s/collectorconfig
</code></pre></div></p>
<p>Add the Prometheus pod (source code is in the <code>k8s/python</code> directory):
<div class="highlight"><pre><span></span><code>kubectl apply -f prometheus-deployment.yaml
</code></pre></div></p>
<h4 id="update-otel-collector-to-scrape-the-prometheus-pod">Update Otel Collector to Scrape the Prometheus Pod<a class="headerlink" href="#update-otel-collector-to-scrape-the-prometheus-pod" title="Permanent link">&para;</a></h4>
<p>Update realm/token/cluster in the <code>otel-prometheus.yaml</code>  </p>
<p>Verify your helm deployment of the collector:</p>
<div class="highlight"><pre><span></span><code>helm list
</code></pre></div>
<p>Upgrade the Collector deployment with the values required for scraping Prometheus metrics from the Prometheus pod deployed in the previous step:</p>
<div class="highlight"><pre><span></span><code>helm upgrade --reuse-values splunk-otel-collector-YOURCOLLECTORVALUE --values otel-prometheus.yaml splunk-otel-collector-chart/splunk-otel-collector
</code></pre></div>
<h4 id="find-prometheus-metric-and-generate-chart">Find Prometheus Metric and Generate Chart<a class="headerlink" href="#find-prometheus-metric-and-generate-chart" title="Permanent link">&para;</a></h4>
<p><code>Splunk Observabilty -&gt; Menu -&gt; Metrics -&gt; Metric Finder</code>  </p>
<p>Search for: <code>customgauge</code>  </p>
<p>Click <code>CustomGauge</code>  </p>
<p>Chart appears with value <code>17</code></p>
<p>Examine the collector update <code>otel-prometheus.yaml</code> to see how this works.</p>
<hr />
<h3 id="7-configure-otel-collector-to-transform-a-metric-name">7: Configure Otel Collector to Transform a Metric Name<a class="headerlink" href="#7-configure-otel-collector-to-transform-a-metric-name" title="Permanent link">&para;</a></h3>
<p>This example uses the <a href="https://github.com/open-telemetry/opentelemetry-collector-contrib/tree/main/processor/metricstransformprocessor">Metrics Transform Processor</a>  </p>
<p>Change to the k8s Collector Config directory:<br />
<div class="highlight"><pre><span></span><code>cd ~/otelworkshop/k8s/collectorconfig
</code></pre></div>
Update realm/token/cluster in the <code>metricstransform.yaml</code> with your token/realm/cluster  </p>
<p>Upgrade the Collector deployment with the values required for scraping Prometheus metrics from the Prometheus pod deployed in the previous step:</p>
<div class="highlight"><pre><span></span><code>helm upgrade --reuse-values splunk-otel-collector-YOURCOLLECTORVALUE --values metricstransform.yaml splunk-otel-collector-chart/splunk-otel-collector
</code></pre></div>
<h4 id="find-transformed-prometheus-metric-and-generate-chart">Find Transformed Prometheus Metric and Generate Chart<a class="headerlink" href="#find-transformed-prometheus-metric-and-generate-chart" title="Permanent link">&para;</a></h4>
<p><code>Splunk Observabilty -&gt; Menu -&gt; Metrics -&gt; Metric Finder</code>  </p>
<p>Search for: <code>transformedgauge</code>  </p>
<p>Click <code>TransformedGauge</code>  </p>
<p>You'll now see the new chart for the metric formerly known as CustomGauge that has been transformed using the metrics transform processor.  </p>
<p>Examine the collector update <code>metricstransform.yaml</code> to see how this works.</p>
<hr />
<h3 id="monitoring-and-troubleshooting">Monitoring and Troubleshooting<a class="headerlink" href="#monitoring-and-troubleshooting" title="Permanent link">&para;</a></h3>
<h4 id="view-otel-collector-pod-stats">View Otel Collector POD stats<a class="headerlink" href="#view-otel-collector-pod-stats" title="Permanent link">&para;</a></h4>
<div class="highlight"><pre><span></span><code>kubectl get pods
</code></pre></div>
<p>Note the pod name of the <code>OpenTelemetry Collector</code> pod i.e.:<br />
<code>splunk-otel-collector-1620505665-agent-sw45w</code></p>
<p>Send the Zpages stats to the lynx browser:<br />
<div class="highlight"><pre><span></span><code>kubectl exec -it YOURAGENTPODHERE -- curl localhost:55679/debug/tracez | lynx -stdin
</code></pre></div>
i.e.
<div class="highlight"><pre><span></span><code>kubectl exec -it splunk-otel-collector-1620505665-agent-sw45w -- curl localhost:55679/debug/tracez | lynx -stdin
</code></pre></div></p>
<p><img src="../../images/06-zpages.png" width="360"> </p>
<h4 id="examine-otel-collector-config">Examine Otel Collector Config<a class="headerlink" href="#examine-otel-collector-config" title="Permanent link">&para;</a></h4>
<p>get your Collector agent pod name via:
<div class="highlight"><pre><span></span><code>kubectl get pods
</code></pre></div></p>
<p>i.e.</p>
<p><code>splunk-otel-collector-1626453714-agent-vfr7s</code> </p>
<p>Show current Collector config:<br />
<div class="highlight"><pre><span></span><code>kubectl exec -it YOURAGENTPODHERE -- curl localhost:55554/debug/configz/effective
</code></pre></div></p>
<p>Show initial Collector config:<br />
<div class="highlight"><pre><span></span><code>kubectl exec -it YOURAGENTPODHERE -- curl localhost:55554/debug/configz/initial
</code></pre></div></p>
<hr />
<h3 id="bonus-instrumentation-examples-istio-and-net">Bonus Instrumentation Examples: Istio and .NET<a class="headerlink" href="#bonus-instrumentation-examples-istio-and-net" title="Permanent link">&para;</a></h3>
<h4 id="net-containerized-example-is-located-here">.NET: containerized example is <a href="dotnet/">located here</a><a class="headerlink" href="#net-containerized-example-is-located-here" title="Permanent link">&para;</a></h4>
<h4 id="istio-service-mesh-lab-here">Istio: service mesh <a href="istio/">lab here</a><a class="headerlink" href="#istio-service-mesh-lab-here" title="Permanent link">&para;</a></h4>
<hr />
<h3 id="clean-up-deployments-and-services">Clean up deployments and services<a class="headerlink" href="#clean-up-deployments-and-services" title="Permanent link">&para;</a></h3>
<p>To delete all k8s lab work:<br />
in <code>~/otelworkshop/k8s/</code><br />
<div class="highlight"><pre><span></span><code>source delete-all-k8s.sh
source delete-prometheus.sh
</code></pre></div></p>
<p>To delete the Collector from k8s:<br />
<div class="highlight"><pre><span></span><code>helm list
</code></pre></div>
<code>helm delete YOURCOLLECTORHERE</code>
i.e.
<div class="highlight"><pre><span></span><code>helm delete splunk-otel-collector-1620505665
</code></pre></div></p>
<p>k3s:
<div class="highlight"><pre><span></span><code>/usr/local/bin/k3s-uninstall.sh
</code></pre></div></p>
                
              
              
                


              
            </article>
          </div>
        </div>
        
          <a href="#" class="md-top md-icon" data-md-component="top" data-md-state="hidden">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8v12z"/></svg>
            Back to top
          </a>
        
      </main>
      
        
<footer class="md-footer">
  
    <nav class="md-footer__inner md-grid" aria-label="Footer">
      
        
        <a href="../host/node/" class="md-footer__link md-footer__link--prev" aria-label="Previous: Node.js" rel="prev">
          <div class="md-footer__button md-icon">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
          </div>
          <div class="md-footer__title">
            <div class="md-ellipsis">
              <span class="md-footer__direction">
                Previous
              </span>
              Node.js
            </div>
          </div>
        </a>
      
      
    </nav>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-footer-copyright">
        
          <div class="md-footer-copyright__highlight">
            Copyright 2021 Splunk Inc. All rights reserved.
          </div>
        
        
          Made with
          <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
            Material for MkDocs
          </a>
        
        
      </div>
      
  <div class="md-footer-social">
    
      
      
        
        
      
      <a href="https://github.com/signalfx/otelworkshop" target="_blank" rel="noopener" title="github.com" class="md-footer-social__link">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 480 512"><path d="M186.1 328.7c0 20.9-10.9 55.1-36.7 55.1s-36.7-34.2-36.7-55.1 10.9-55.1 36.7-55.1 36.7 34.2 36.7 55.1zM480 278.2c0 31.9-3.2 65.7-17.5 95-37.9 76.6-142.1 74.8-216.7 74.8-75.8 0-186.2 2.7-225.6-74.8-14.6-29-20.2-63.1-20.2-95 0-41.9 13.9-81.5 41.5-113.6-5.2-15.8-7.7-32.4-7.7-48.8 0-21.5 4.9-32.3 14.6-51.8 45.3 0 74.3 9 108.8 36 29-6.9 58.8-10 88.7-10 27 0 54.2 2.9 80.4 9.2 34-26.7 63-35.2 107.8-35.2 9.8 19.5 14.6 30.3 14.6 51.8 0 16.4-2.6 32.7-7.7 48.2 27.5 32.4 39 72.3 39 114.2zm-64.3 50.5c0-43.9-26.7-82.6-73.5-82.6-18.9 0-37 3.4-56 6-14.9 2.3-29.8 3.2-45.1 3.2-15.2 0-30.1-.9-45.1-3.2-18.7-2.6-37-6-56-6-46.8 0-73.5 38.7-73.5 82.6 0 87.8 80.4 101.3 150.4 101.3h48.2c70.3 0 150.6-13.4 150.6-101.3zm-82.6-55.1c-25.8 0-36.7 34.2-36.7 55.1s10.9 55.1 36.7 55.1 36.7-34.2 36.7-55.1-10.9-55.1-36.7-55.1z"/></svg>
      </a>
    
      
      
        
        
      
      <a href="https://twitter.com/splunk" target="_blank" rel="noopener" title="twitter.com" class="md-footer-social__link">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path d="M459.37 151.716c.325 4.548.325 9.097.325 13.645 0 138.72-105.583 298.558-298.558 298.558-59.452 0-114.68-17.219-161.137-47.106 8.447.974 16.568 1.299 25.34 1.299 49.055 0 94.213-16.568 130.274-44.832-46.132-.975-84.792-31.188-98.112-72.772 6.498.974 12.995 1.624 19.818 1.624 9.421 0 18.843-1.3 27.614-3.573-48.081-9.747-84.143-51.98-84.143-102.985v-1.299c13.969 7.797 30.214 12.67 47.431 13.319-28.264-18.843-46.781-51.005-46.781-87.391 0-19.492 5.197-37.36 14.294-52.954 51.655 63.675 129.3 105.258 216.365 109.807-1.624-7.797-2.599-15.918-2.599-24.04 0-57.828 46.782-104.934 104.934-104.934 30.213 0 57.502 12.67 76.67 33.137 23.715-4.548 46.456-13.32 66.599-25.34-7.798 24.366-24.366 44.833-46.132 57.827 21.117-2.273 41.584-8.122 60.426-16.243-14.292 20.791-32.161 39.308-52.628 54.253z"/></svg>
      </a>
    
      
      
        
        
      
      <a href="https://www.linkedin.com/company/splunk/" target="_blank" rel="noopener" title="www.linkedin.com" class="md-footer-social__link">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path d="M416 32H31.9C14.3 32 0 46.5 0 64.3v383.4C0 465.5 14.3 480 31.9 480H416c17.6 0 32-14.5 32-32.3V64.3c0-17.8-14.4-32.3-32-32.3zM135.4 416H69V202.2h66.5V416zm-33.2-243c-21.3 0-38.5-17.3-38.5-38.5S80.9 96 102.2 96c21.2 0 38.5 17.3 38.5 38.5 0 21.3-17.2 38.5-38.5 38.5zm282.1 243h-66.4V312c0-24.8-.5-56.7-34.5-56.7-34.6 0-39.9 27-39.9 54.9V416h-66.4V202.2h63.7v29.2h.9c8.9-16.8 30.6-34.5 62.9-34.5 67.2 0 79.7 44.3 79.7 101.9V416z"/></svg>
      </a>
    
  </div>

    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    <script id="__config" type="application/json">{"base": "../..", "features": ["navigation.tabs", "navigation.instant", "navigation.sections", "navigation.expand", "navigation.top"], "translations": {"clipboard.copy": "Copy to clipboard", "clipboard.copied": "Copied to clipboard", "search.config.lang": "en", "search.config.pipeline": "trimmer, stopWordFilter", "search.config.separator": "[\\s\\-]+", "search.placeholder": "Search", "search.result.placeholder": "Type to start searching", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.term.missing": "Missing", "select.version.title": "Select version"}, "search": "../../assets/javascripts/workers/search.8397ff9e.min.js", "version": null}</script>
    
    
      <script src="../../assets/javascripts/bundle.f89c2efe.min.js"></script>
      
    
  </body>
</html>